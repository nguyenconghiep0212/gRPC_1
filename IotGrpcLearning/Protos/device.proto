syntax = "proto3";
option csharp_namespace = "IotGrpcLearning.Proto";

package iot.device;

service DeviceGateway {
  // Unary hello (already implemented)
  rpc Init (DeviceInitRequest) returns (DeviceInitResponse);

  // Client-streaming telemetry → single ack
  rpc SendTelemetry (stream TelemetryPoint) returns (TelemetryAck);

  // Server-streaming (device subscribes; server pushes commands)
  rpc SubscribeCommands (DeviceId) returns (stream Command);
}

// A device greets the gateway once it connects
message DeviceInitRequest {
  string device_id = 1;   // e.g., "station 1"
  string fw_version = 2;  // firmware version, e.g., "1.0.3"
}

message DeviceInitResponse {
  string message = 1;     // friendly text
  int64 server_unix_ms = 2; // server time in ms since epoch
}


// Telemetry Data

message Temperature {
  double celsius = 1;
}

message Rpm {
  double value = 1;
}

message Vibration {
  double mm_per_s = 1;
}


message TelemetryPoint {
  string device_id = 1;         // which device sent this
  int64 unix_ms = 4;            // event time (ms since epoch)
  oneof reading {
    Temperature temperature = 10;
    Rpm rpm = 11;
    Vibration vibration = 12;
  }

}

message TelemetryAck {
  int32 accepted = 1;
  int32 rejected = 2;
  string note = 3;              // optional info (e.g., "ok", "some invalid")
}

// Command message and server-streaming RPC
message DeviceId {
  string id = 1;
}

message Command {
  string command_id = 1;            // server-generated GUID
  string name = 2;                  // e.g., "Ping", "EnterSafeMode"
  map<string, string> args = 3;     // optional, e.g., {"level":"crit"}
}



